<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小窍门 - 注册</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <link type="text/css" rel="stylesheet" href="login_assets/css/login.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

</head>
<body class="login_bj">

<div class="zhuce_body">
    <div class="zhuce_kong">
        <div class="zc">
            <div class="bj_bai">
                <h3>注册 小窍门CRM</h3>
                <form id="regist_form">
                    <input name="email" id="email" type="text" class="kuang_txt email" placeholder="邮箱">
                    <input name="username" id="username" type="text" class="kuang_txt username" placeholder="姓名">
                    <input name="password" id="pwd" type="password" class="kuang_txt password" placeholder="密码">
                    <input type="password" id="repwd" class="kuang_txt password" placeholder="确认密码">
                    <input name="" type="text" class="kuang_txt yanzm" placeholder="验证码">
                    <!--<div style="margin: 10px 0">
                        <div class="hui_kuang"><img src="login_assets/images/zc_22.jpg" width="92" height="31"></div>
                        <div class="shuaxin"><a href="#"><img src="login_assets/images/zc_25.jpg" width="13"
                                                              height="14"></a></div>
                    </div>-->
                    <div id="error"></div>
                    <!--<div>-->
                    <!--<input name="" type="checkbox" value=""><span>已阅读并同意<a href="#" target="_blank"><span class="lan">《XXXXX使用协议》</span></a></span>-->
                    <!--</div>-->
                    <button type="button" class="btn_zhuce" onclick="regist()" style="margin: 10px 0">注册</button>

                </form>
            </div>
            <div class="bj_right">
                <p>使用以下账号直接登录</p>
                <a href="#" class="zhuce_qq">QQ注册</a>
                <a href="#" class="zhuce_wb">微博注册</a>
                <a href="#" class="zhuce_wx">微信注册</a>
                <p>已有账号？<a href="login.html">立即登录</a></p>

            </div>
        </div>
        <P>Powered by 小窍门信息技术有限公司</P>
    </div>

</div>
</body>
<script>
    function regist() {
        var email = $("#email").val();
        var pwd = $("#pwd").val();
        var repwd = $("#repwd").val();
        var username = $("#username").val();
        if (email === undefined || email.trim() === "") {
            $("#error").html("请输入邮箱");
            return;
        }
        if (pwd === undefined || pwd.trim() === "") {
            $("#error").html("请输入密码");
            return;
        }
        if (repwd === undefined || repwd.trim() === "") {
            $("#error").html("请输入确认密码");
            return;
        }
        if (pwd.length < 6) {
            $("#error").html("密码不能小于6位");
            return;
        }
        if (repwd != pwd) {
            $("#error").html("两次密码不一致");
            return;
        }
        if (username === undefined || username === "") {
            $("#error").html("姓名不能为空");
            return;
        }
        $.ajax({
                url: "public/api/regist",
                data: $("#regist_form").serialize(),
                dataType: "JSON",
                type: "POST",
                success: function (res) {
                    if (res["status"] == 200) {
                        alert("注册成功，前往登陆");
                        var pathName = document.location.pathname;
                        var index = pathName.substr(1).indexOf("/");
                        var result = pathName.substr(0, index + 1);
                        result = result + "/login.html";
                        window.location.href = result;
                    } else {
                        $("#error").html(res["data"]);
                    }
                }

            }
        )
    }
</script>
</html>